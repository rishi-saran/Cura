{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>My Rewards</title>
    <link rel="stylesheet" href="{% static 'assets/css/rewards.css' %}">
    <script defer src="{% static 'assets/js/scripts.js' %}"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>My Rewards</h1>
            <!-- dynamic total XP -->
            <div class="xp">XP {{ total_points|default:0 }}</div>
        </header>

        <!-- show any alerts (e.g., ‚Äú+50 points added‚Äù, ‚Äúrewards unlocked‚Äù) -->
        {% if messages %}
          <div class="messages">
            {% for message in messages %}
              <div id="msg" class="alert {% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</div>
            {% endfor %}
          </div>
        {% endif %}

        <div class="profile-section">
            <div class="profile-image">
                <img src="{% static 'assets/images/father.png' %}" alt="Profile Picture">
                <div class="edit-icon">‚úèÔ∏è</div>
            </div>
            <!-- dynamic name & email; falls back to user -->
            <h2>{{ profile.name|default:request.user.username }}</h2>
            <p>{{ profile.email|default:request.user.email }}</p>

            <!-- claim today‚Äôs +50 if not already checked in -->
            {% if not today_checked_in %}
              <form action="{% url 'rewards_checkin' %}" method="post" style="margin-top:10px;">
                {% csrf_token %}
                <button type="submit" class="claim-btn">Claim today‚Äôs +50</button>
              </form>
            {% else %}
              <p style="margin-top:10px;">‚úÖ Today's +50 claimed</p>
            {% endif %}
        </div>

        <div class="claimables-section">
            <h3>Claimables</h3>

            <!-- render tiers from view context as gift cards (no QR) -->
            {% for tier in tiers %}
              <div class="voucher {% if tier.unlocked %}unlocked{% else %}locked{% endif %}">
                <div class="voucher-left">
                  <h4>üéÅ {{ tier.title }}</h4>
                  <p class="voucher-type">{{ tier.points }} pts ‚Ä¢ Gift Card</p>
                </div>
                <div class="voucher-right">
                  {% if tier.unlocked %}
                    {% if tier.claimed %}
                      <span class="voucher-price">‚úÖ Claimed</span>
                    {% else %}
                      {% if tier.id %}
                        <a class="claim-link" href="{% url 'claim_reward' tier.id %}">Claim gift</a>
                      {% else %}
                        <button type="button" style="width:50px; background-color:black; color:white; border-radius: 20px;">Claim</button>
                        <span class="voucher-price">üéâ</span>
                      {% endif %}
                    {% endif %}
                  {% else %}
                    <span class="voucher-price">{{ tier.remaining }} to go</span>
                  {% endif %}
                </div>
              </div>
            {% empty %}
              <p>No rewards configured yet.</p>
            {% endfor %}
        </div>
    </div>

    <div class="bottom-nav">
        <a href="{% url 'famil' %}"><img src="{% static 'assets/images/navbar/modules-active.png' %}"></a>
        <a href="{% url 'leaderboard' %}"><img src="{% static 'assets/images/navbar/graph.png' %}"></a>
        <a href="{% url 'notifications' %}"><img src="{% static 'assets/images/navbar/bell.png' %}"></a>
        <a href="{% url 'settings' %}"><img src="{% static 'assets/images/navbar/settings.png' %}"></a>
    </div>

    <script src="{% static 'assets/js/scripts.js' %}"></script>
    {% include 'chatbot.html' %}
</body>
</html>
